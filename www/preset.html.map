{"version":3,"sources":["preset.html"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"preset.html","sourcesContent":["<html>\n<head>\n    <title>Flot Preset</title>\n    <link href=\"img/favicon.png\" rel=\"shortcut icon\" type=\"image/x-icon\"></link>\n    <link type=\"text/css\" rel=\"stylesheet\" href=\"../../lib/css/themes/jquery-ui/default/jquery-ui.min.css\"></link>\n    <script type=\"text/javascript\" src=\"../../lib/js/jquery-1.11.1.min.js\"></script>\n    <script type=\"text/javascript\" src=\"../../lib/js/socket.io.js\"></script>\n    <script type=\"text/javascript\" src=\"../../_socket/info.js\"></script>\n    <script type=\"text/javascript\">\n        var presets         \t= {};\n        var currentChart    \t= null;\n        var loaded          \t= false;\n        var instance        \t= 0;\n        var socket;\n\n        function init() {\n            console.log('Initialize...');\n            var params = location.href.split('?')[1];\n            if (params && params.match(/^preset=/)) {\n                currentChart = decodeURIComponent(params.replace(/^preset=/, ''));\n            }\n            setTimeout(function () {\n                initSocket();\n            }, 200);\n        }\n\n        function initSocket() {\n            console.log('Init connection...');\n            // Read instances\n            socket = io.connect(socketUrl, {\n                query: {\n                    key: socketSession\n                },\n                reconnectionDelay: 10000,\n                reconnectionAttempts: Infinity,\n                upgrade: typeof socketForceWebSockets !== 'undefined' ? !socketForceWebSockets : undefined,\n                rememberUpgrade: typeof socketForceWebSockets !== 'undefined' ? socketForceWebSockets : undefined,\n                transports: typeof socketForceWebSockets !== 'undefined' ? (socketForceWebSockets ? ['websocket'] : undefined) : undefined\n            });\n\n            socket.on('connect', function () {\n                console.log('Connected');\n                setTimeout(function () {\n                    socket.emit('name', 'flotPreset');\n                }, 50);\n                setTimeout(function () {\n                    getPresets(socket, function () {\n                        console.log(\"Got presets\");\n                        console.log(presets);\n                        if (currentChart && presets[currentChart]) {\n                            loadChart(currentChart);\n                        } else if (currentChart && presets[\"flot.\" + instance + \".\" + currentChart]) {\n                            loadChart(\"flot.\" + instance + \".\" + currentChart);\n                        } else {\n                            showPresets();\n                        }\n                    });\n                }, 100);\n            });\n\n            socket.on('disconnect', function () {\n                console.log('Lost connection');\n            });\n\n            socket.on('error', function (e) {\n                console.error('Socket error: ' + e);\n            });\n            socket.on('connect_error', function (e) {\n                console.error('Socket error: ' + e);\n            });\n        }\n\n        function getPresets(socket, callback) {\n            // read presets\n            socket.emit('getObjectView', 'chart', 'chart', {\n                startkey: 'flot.' + instance + '.',\n                endkey: 'flot.' + instance + '.\\u9999'\n            }, function (err, res) {\n                presets = {};\n                loaded  = true;\n                if (res && res.rows) {\n                    for (var i = 0; i < res.rows.length; i++) {\n                        presets[res.rows[i].value._id] = res.rows[i].value;\n                    }\n                }\n                callback && callback();\n            });\n        }\n\n        function showPresets() {\n            var presetList = \"\";\n            for (var id in presets) {\n                if (!presets.hasOwnProperty(id)) continue;\n                var obj = presets[id];\n                presetList += \"<a href='index.html?\" + obj.native.url + \"' data-role='button'>\" + obj.common.name + \"</a><br>\";\n            }\n            $('#presetList').html(presetList);\n        }\n\n        function loadChart(id, callback) {\n            window.location.replace(\"index.html?\" + presets[id].native.url);\n            callback && callback();\n        }\n\n        $(document).ready(init());\n\n    </script>\n</head>\n<body>\n<p id=\"presetList\">loading...</p>\n</body>\n</html>\n"]}